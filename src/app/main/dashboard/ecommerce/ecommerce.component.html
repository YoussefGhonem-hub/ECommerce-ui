<div class="content-wrapper container-xxl p-0">
  <div class="content-body">
    <div class="row match-height" *ngIf="isAdmin || isClient">
      <!-- Statistics Card -->
      <div class="col-xl-12 col-md-12 col-12">
        <div class="card card-statistics">
          <div class="card-header">
            <h4 class="card-title">Statistics</h4>
            <div class="d-flex align-items-center">
              <p class="card-text font-small-2 mr-25 mb-0">Updated 1 month ago</p>
            </div>
          </div>
          <div class="card-body statistics-body">
            <div class="row">
              <div class="col-sm-6 col-xl-3 mb-2 mb-xl-0">
                <div class="media">
                  <div class="avatar bg-light-primary mr-2">
                    <div class="avatar-content">
                      <i data-feather="trending-up" class="avatar-icon"></i>
                    </div>
                  </div>
                  <div class="media-body my-auto">
                    <h4 class="font-weight-bolder mb-0">{{ data?.statistics?.analyticsData?.sales }}</h4>
                    <p class="card-text font-small-3 mb-0">Sales</p>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-xl-3 mb-2 mb-xl-0">
                <div class="media">
                  <div class="avatar bg-light-info mr-2">
                    <div class="avatar-content">
                      <i data-feather="user" class="avatar-icon"></i>
                    </div>
                  </div>
                  <div class="media-body my-auto">
                    <h4 class="font-weight-bolder mb-0">{{ data?.statistics?.analyticsData?.customers }}</h4>
                    <p class="card-text font-small-3 mb-0">Customers</p>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-xl-3 mb-2 mb-sm-0">
                <div class="media">
                  <div class="avatar bg-light-danger mr-2">
                    <div class="avatar-content">
                      <i data-feather="box" class="avatar-icon"></i>
                    </div>
                  </div>
                  <div class="media-body my-auto">
                    <h4 class="font-weight-bolder mb-0">{{ data?.statistics?.analyticsData?.products }}</h4>
                    <p class="card-text font-small-3 mb-0">Products</p>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-xl-3">
                <div class="media">
                  <div class="avatar bg-light-success mr-2">
                    <div class="avatar-content">
                      <i data-feather="dollar-sign" class="avatar-icon"></i>
                    </div>
                  </div>
                  <div class="media-body my-auto">
                    <h4 class="font-weight-bolder mb-0">{{ data?.statistics?.analyticsData?.revenue }}</h4>
                    <p class="card-text font-small-3 mb-0">Revenue</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--/ Statistics Card -->
    </div>

    <!-- Top Products & Low Stock Products -->
    <div class="row match-height mt-2" *ngIf="isAdmin">
      <div class="col-lg-6 col-12">
        <div class="card">
          <div class="card-header">
            <h4 class="card-title">Top Products</h4>
          </div>
          <div class="card-body">
            <ul class="list-group">
              <li *ngFor="let p of data?.topProducts; let i = index"
                class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <a [routerLink]="['/apps/e-commerce/details', p.id]">{{ p.nameEn || p.nameAr || 'Product' }}</a>
                  <div class="small text-muted">Orders: {{ p.ordersCount }}</div>
                </div>
                <span class="badge badge-primary badge-pill">{{ p.ordersCount }}</span>
              </li>
              <li *ngIf="!data?.topProducts || data?.topProducts.length === 0" class="list-group-item text-muted">No top
                products</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="col-lg-6 col-12">
        <div class="card">
          <div class="card-header">
            <h4 class="card-title">Low Stock Products</h4>
          </div>
          <div class="card-body">
            <ul class="list-group">
              <li *ngFor="let p of data?.lowStockProducts"
                class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <a [routerLink]="['/apps/e-commerce/details', p.id]">{{ p.nameEn || p.nameAr || 'Product' }}</a>
                  <div class="small text-muted">Stock: {{ p.stockQuantity }}</div>
                </div>
                <span class="text-danger font-weight-bolder">{{ p.stockQuantity }}</span>
              </li>
              <li *ngIf="!data?.lowStockProducts || data?.lowStockProducts.length === 0"
                class="list-group-item text-muted">No low-stock products</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="row match-height" *ngIf="isAdmin">
      <div class="col-lg-4 col-12">
        <div class="row match-height">
          <!-- Bar Chart Orders -->
          <div class="col-lg-6 col-md-3 col-6">
            <div class="card">
              <div class="card-body pb-50">
                <h6>Orders</h6>
                <h2 class="font-weight-bolder mb-1">{{ data?.ordersChart?.analyticsData?.orders }}</h2>
                <div id="statistics-bar-chart" #statisticsBarChartRef>
                  <!-- Apexchart component-->
                  <apx-chart *ngIf="data?.ordersChart?.series" [series]="data?.ordersChart?.series" [chart]="{
                      height: 70,
                      width: isMenuToggled === false ? statisticsBarChartRef.offsetWidth : statisticsBar.chart.width,
                      type: 'bar',
                      stacked: true,
                      toolbar: {
                        show: false
                      }
                    }" [tooltip]="statisticsBar.tooltip" [colors]="statisticsBar.colors"
                    [dataLabels]="statisticsBar.dataLabels" [grid]="statisticsBar.grid"
                    [plotOptions]="statisticsBar.plotOptions" [dataLabels]="statisticsBar.dataLabels"
                    [xaxis]="statisticsBar.xaxis" [yaxis]="statisticsBar.yaxis"></apx-chart>
                </div>
              </div>
            </div>
          </div>
          <!--/ Bar Chart Orders -->

          <!-- Line Chart Profit -->
          <div class="col-lg-6 col-md-3 col-6">
            <div class="card card-tiny-line-stats">
              <div class="card-body pb-50">
                <h6>Profit</h6>
                <h2 class="font-weight-bolder mb-1">{{ data?.profitChart?.analyticsData?.profit }}</h2>
                <div *ngIf="statisticsLine?.grid" id="statistics-line-chart" #statisticsLineChartRef>
                  <apx-chart *ngIf="statisticsLine?.grid" [chart]="{
                      height: 70,
                      width: isMenuToggled === false ? statisticsLineChartRef?.offsetWidth : statisticsLine.chart.width,
                      type: 'line',
                      toolbar: {
                        show: false
                      },
                      zoom: {
                        enabled: false
                      }
                    }" [grid]="statisticsLine?.grid" [stroke]="statisticsLine.stroke" [colors]="statisticsLine.colors"
                    [series]="data?.profitChart.series" [markers]="statisticsLine.markers"
                    [xaxis]="statisticsLine.xaxis" [yaxis]="statisticsLine.yaxis"
                    [tooltip]="statisticsLine.tooltip"></apx-chart>
                </div>
              </div>
            </div>
          </div>
          <!--/ Line Chart Profit -->

          <!-- Earnings Chart -->
          <div class="col-lg-12 col-md-6 col-12">
            <div class="card earnings-card">
              <div class="card-body">
                <div class="row">
                  <div class="col-6">
                    <h4 class="card-title mb-1">Earnings</h4>
                    <div class="font-small-2">This Month</div>
                    <h5 class="mb-1">{{ data?.earning?.thisMonthTotal | number:'1.2-2' }} EGP</h5>
                    <p class="card-text text-muted font-small-2">
                      <span class="font-weight-bolder">{{ (data?.earning?.percentChange || 0) | number:'1.0-1'
                        }}%</span>
                      <span> {{ (data?.earning?.percentChange || 0) >= 0 ? 'more' : 'less' }} earnings than last
                        month.</span>
                    </p>
                  </div>
                  <div class="col-6">
                    <div id="earnings-donut-chart" #earningChartRef>
                      <!-- Apexchart component-->
                      <apx-chart [chart]="{
                          type: 'donut',
                          width:
                            isMenuToggled === false ? earningChartRef.offsetWidth : earningChartoptions.chart.width,
                          height: 120,
                          toolbar: {
                            show: false
                          }
                        }" [dataLabels]="earningChartoptions.dataLabels" [series]="earningChartoptions.series"
                        [legend]="earningChartoptions.legend" [labels]="earningChartoptions.labels"
                        [stroke]="earningChartoptions.stroke" [colors]="earningChartoptions.colors"
                        [grid]="earningChartoptions.grid" [plotOptions]="earningChartoptions.plotOptions"></apx-chart>
                      <!-- / Apexchart component-->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--/ Earnings Chart -->
        </div>
      </div>
      <div class="col-lg-12 col-12">
        <!-- Revenue Report Card -->
        <div class="card card-revenue-budget">
          <div class="row mx-0">
            <div class="col-md-12 col-12 revenue-report-wrapper">
              <div
                class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3">
                <h4 class="card-title mb-2 mb-md-0">Revenue Report</h4>

                <!-- Legend and Filters -->
                <div class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center w-100 w-md-auto">
                  <!-- Legend -->
                  <div class="d-flex align-items-center mb-2 mb-sm-0 mr-sm-2">
                    <div class="d-flex align-items-center mr-2">
                      <span class="bullet bullet-primary font-small-3 mr-50 cursor-pointer"></span>
                      <span class="small">Earning</span>
                    </div>
                    <div class="d-flex align-items-center">
                      <span class="bullet bullet-warning font-small-3 mr-50 cursor-pointer"></span>
                      <span class="small">Expense</span>
                    </div>
                  </div>

                  <!-- Filters -->
                  <div class="revenue-filters w-100 w-sm-auto">
                    <div class="d-flex flex-wrap align-items-center gap-1">
                      <input type="date" class="form-control form-control-sm flex-grow-1 flex-sm-grow-0 mb-1 mb-sm-0"
                        style="min-width: 120px; max-width: 150px;" [(ngModel)]="revenueFilter.start"
                        placeholder="Start" />
                      <input type="date" class="form-control form-control-sm flex-grow-1 flex-sm-grow-0 mb-1 mb-sm-0"
                        style="min-width: 120px; max-width: 150px;" [(ngModel)]="revenueFilter.end" placeholder="End" />
                      <select class="form-control form-control-sm flex-grow-1 flex-sm-grow-0 mb-1 mb-sm-0"
                        style="min-width: 100px; max-width: 120px;" [(ngModel)]="revenueFilter.granularity">
                        <option value="day">Day</option>
                        <option value="week">Week</option>
                        <option value="month">Month</option>
                      </select>
                      <button class="btn btn-sm btn-primary flex-grow-1 flex-sm-grow-0"
                        (click)="applyRevenueFilters()">Apply</button>
                    </div>
                  </div>
                </div>
              </div>
              <div id="revenue-report-chart" #revenueReportChartRef>
                <apx-chart [series]="data?.revenueReport.earningExpenseChart.series" [chart]="{
                    height: 230,
                    width:
                      isMenuToggled === false
                        ? revenueReportChartRef.offsetWidth
                        : revenueReportChartoptions.chart.width,
                    stacked: true,
                    type: 'bar',
                    toolbar: { show: false }
                  }" [plotOptions]="revenueReportChartoptions.plotOptions" [colors]="revenueReportChartoptions.colors"
                  [dataLabels]="revenueReportChartoptions.dataLabels" [legend]="revenueReportChartoptions.legend"
                  [grid]="revenueReportChartoptions.grid" [xaxis]="revenueReportChartoptions.xaxis"
                  [yaxis]="revenueReportChartoptions.yaxis"></apx-chart>
              </div>
            </div>
          </div>
        </div>
        <!--/ Revenue Report Card -->
      </div>
    </div>
  </div>
</div>